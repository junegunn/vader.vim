sudo: false
language: ruby
rvm:
  - 2.2.3

install:
  - pip install --user covimerage
  - git clone --depth=1 https://github.com/vim/vim
  - cd vim
  - ./configure --with-features=huge --enable-rubyinterp --enable-pythoninterp --prefix /tmp/vim
  - make
  - make install
  - cd -
  - PATH=/tmp/vim/bin:$PATH

script:
  - export LD_LIBRARY_PATH=~/.rvm/rubies/ruby-2.2.3/lib
  - vim --version
  - VADER_TEST_VIM="covimerage run --source $PWD --data-file $PWD/.coverage.covimerage vim" ./test/run-tests.sh

after_success:
  - covimerage -vv xml
  - bash <(curl -s https://codecov.io/bash) -X search -X gcov -X coveragepy -f coverage.xml
